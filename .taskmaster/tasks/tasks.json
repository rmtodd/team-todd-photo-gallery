{
  "tasks": [
    {
      "id": 1,
      "title": "Project Setup and Configuration",
      "description": "Initialize Next.js 14+ project with App Router, TypeScript, Tailwind CSS, and configure essential development tools.",
      "details": "1. Create a new Next.js project with App Router:\n```bash\nnpx create-next-app@latest team-todd-photo-gallery --typescript --tailwind --app\n```\n2. Configure TypeScript with strict mode\n3. Set up ESLint and Prettier:\n```bash\nnpm install --save-dev eslint-config-prettier prettier\n```\n4. Configure Husky pre-commit hooks:\n```bash\nnpm install --save-dev husky lint-staged\nnpx husky install\nnpx husky add .husky/pre-commit \"npx lint-staged\"\n```\n5. Create lint-staged.config.js\n6. Set up basic folder structure:\n   - app/ (for App Router)\n   - components/\n   - lib/\n   - public/\n   - styles/\n7. Configure Tailwind CSS for the project\n8. Set up Jest and React Testing Library:\n```bash\nnpm install --save-dev jest @testing-library/react @testing-library/jest-dom jest-environment-jsdom\n```",
      "testStrategy": "1. Verify project builds without errors\n2. Confirm TypeScript, ESLint, and Prettier configurations work correctly\n3. Test pre-commit hooks by making changes and committing\n4. Run a basic test to ensure testing framework is properly configured",
      "priority": "high",
      "dependencies": [],
      "status": "done",
      "subtasks": []
    },
    {
      "id": 2,
      "title": "Cloudinary Integration Setup",
      "description": "Set up Cloudinary account, configure API integration, and establish folder structure for photo storage.",
      "details": "1. Create a Cloudinary account if not already available\n2. Install Cloudinary SDK:\n```bash\nnpm install cloudinary next-cloudinary\n```\n3. Configure environment variables in .env.local:\n```\nCLOUDINARY_CLOUD_NAME=your_cloud_name\nCLOUDINARY_API_KEY=your_api_key\nCLOUDINARY_API_SECRET=your_api_secret\n```\n4. Create utility functions for Cloudinary in lib/cloudinary.ts:\n```typescript\nimport { v2 as cloudinary } from 'cloudinary';\n\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nexport default cloudinary;\n\nexport async function getPhotos(options = {}) {\n  const results = await cloudinary.search\n    .expression('resource_type:image')\n    .sort_by('created_at', 'desc')\n    .max_results(30)\n    .execute();\n  return results;\n}\n```\n5. Set up folder structure in Cloudinary for organizing photos\n6. Configure transformation presets for different image sizes (thumbnail: 400px, display: 1200px, fullsize: 2560px)",
      "testStrategy": "1. Test API connection by fetching a sample image\n2. Verify environment variables are correctly loaded\n3. Test the getPhotos function to ensure it returns expected results\n4. Validate transformation presets work correctly",
      "priority": "high",
      "dependencies": [
        1
      ],
      "status": "done",
      "subtasks": []
    },
    {
      "id": 3,
      "title": "Authentication System Implementation",
      "description": "Implement a simple password-based authentication system with two access levels: upload+view and view-only.",
      "details": "1. Add authentication environment variables to .env.local:\n```\nUPLOAD_PASSWORD=secure_password_for_couple\nGALLERY_PASSWORD=password_for_family_viewing\nSESSION_DURATION=168\n```\n2. Create authentication middleware in middleware.ts:\n```typescript\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport function middleware(request: NextRequest) {\n  const authCookie = request.cookies.get('auth-token');\n  const path = request.nextUrl.pathname;\n  \n  // Allow access to login page\n  if (path === '/login') {\n    return NextResponse.next();\n  }\n  \n  // Check for upload paths\n  if (path.startsWith('/upload') && authCookie?.value !== process.env.UPLOAD_PASSWORD) {\n    return NextResponse.redirect(new URL('/login?from=upload', request.url));\n  }\n  \n  // Check for gallery access\n  if (!authCookie?.value) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n  \n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/((?!api|_next/static|favicon.ico).*)'],\n};\n```\n3. Create login page in app/login/page.tsx with form for password entry\n4. Implement login API route in app/api/auth/route.ts to set encrypted cookies\n5. Add session management with expiration based on SESSION_DURATION",
      "testStrategy": "1. Test login with correct and incorrect passwords\n2. Verify upload access is restricted to users with UPLOAD_PASSWORD\n3. Confirm view-only access works with GALLERY_PASSWORD\n4. Test session expiration after configured duration\n5. Ensure redirects work correctly for protected routes",
      "priority": "high",
      "dependencies": [
        1
      ],
      "status": "done",
      "subtasks": []
    },
    {
      "id": 4,
      "title": "Photo Gallery Grid Implementation",
      "description": "Create a responsive, masonry-style photo grid with infinite scrolling using React Photo Album.",
      "details": "1. Install React Photo Album:\n```bash\nnpm install react-photo-album\n```\n2. Create PhotoGallery component in components/PhotoGallery.tsx:\n```typescript\nimport React, { useState, useEffect } from 'react';\nimport PhotoAlbum from 'react-photo-album';\nimport { useInView } from 'react-intersection-observer';\nimport { SWRConfig, useSWR } from 'swr';\n\nconst fetcher = (url) => fetch(url).then((res) => res.json());\n\nconst PhotoGallery = () => {\n  const [photos, setPhotos] = useState([]);\n  const [page, setPage] = useState(1);\n  const { ref, inView } = useInView();\n  \n  const { data, error, isLoading } = useSWR(\n    `/api/photos?page=${page}&limit=30`,\n    fetcher,\n    { revalidateOnFocus: false }\n  );\n  \n  useEffect(() => {\n    if (data?.photos) {\n      setPhotos((prevPhotos) => [...prevPhotos, ...data.photos]);\n    }\n  }, [data]);\n  \n  useEffect(() => {\n    if (inView) {\n      setPage((prevPage) => prevPage + 1);\n    }\n  }, [inView]);\n  \n  if (error) return <div>Failed to load photos</div>;\n  \n  return (\n    <div className=\"container mx-auto px-4\">\n      <PhotoAlbum\n        layout=\"masonry\"\n        photos={photos.map((photo) => ({\n          src: photo.secure_url,\n          width: photo.width,\n          height: photo.height,\n          key: photo.public_id,\n        }))}\n        spacing={8}\n        targetRowHeight={300}\n        onClick={({ index }) => console.log(`Clicked photo at index ${index}`)}\n      />\n      {isLoading && <div className=\"text-center py-4\">Loading...</div>}\n      <div ref={ref} className=\"h-10\" />\n    </div>\n  );\n};\n\nexport default PhotoGallery;\n```\n3. Create API route for photos in app/api/photos/route.ts:\n```typescript\nimport { NextResponse } from 'next/server';\nimport cloudinary from '@/lib/cloudinary';\n\nexport async function GET(request) {\n  const { searchParams } = new URL(request.url);\n  const page = parseInt(searchParams.get('page') || '1');\n  const limit = parseInt(searchParams.get('limit') || '30');\n  const nextCursor = searchParams.get('next_cursor');\n  \n  try {\n    const result = await cloudinary.v2.search\n      .expression('resource_type:image')\n      .sort_by('created_at', 'desc')\n      .max_results(limit)\n      .next_cursor(nextCursor)\n      .execute();\n      \n    return NextResponse.json({\n      photos: result.resources,\n      next_cursor: result.next_cursor,\n      total_count: result.total_count,\n    });\n  } catch (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n```\n4. Implement virtual scrolling for performance optimization\n5. Add responsive grid layout with adaptive columns based on screen size\n6. Implement loading indicators and placeholders",
      "testStrategy": "1. Test gallery rendering with different screen sizes\n2. Verify infinite scrolling loads more photos when reaching the bottom\n3. Test performance with a large number of photos (1000+)\n4. Verify loading indicators appear correctly\n5. Test error handling when API fails",
      "priority": "high",
      "dependencies": [
        2,
        3
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 5,
      "title": "Photo Modal View Implementation",
      "description": "Create a full-screen modal view for photos with swipe gestures, pinch-to-zoom, and position retention.",
      "details": "1. Install Framer Motion for animations:\n```bash\nnpm install framer-motion\n```\n2. Create PhotoModal component in components/PhotoModal.tsx:\n```typescript\nimport React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useSwipeable } from 'react-swipeable';\n\ninterface PhotoModalProps {\n  photos: any[];\n  currentIndex: number;\n  isOpen: boolean;\n  onClose: () => void;\n  onNavigate: (newIndex: number) => void;\n}\n\nconst PhotoModal: React.FC<PhotoModalProps> = ({\n  photos,\n  currentIndex,\n  isOpen,\n  onClose,\n  onNavigate,\n}) => {\n  const [scale, setScale] = useState(1);\n  \n  const handlers = useSwipeable({\n    onSwipedLeft: () => {\n      if (currentIndex < photos.length - 1) {\n        onNavigate(currentIndex + 1);\n      }\n    },\n    onSwipedRight: () => {\n      if (currentIndex > 0) {\n        onNavigate(currentIndex - 1);\n      }\n    },\n    trackMouse: true,\n  });\n  \n  const handleZoomIn = () => setScale(scale + 0.5);\n  const handleZoomOut = () => setScale(Math.max(1, scale - 0.5));\n  const handleReset = () => setScale(1);\n  \n  if (!isOpen) return null;\n  \n  const photo = photos[currentIndex];\n  \n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90\"\n        onClick={onClose}\n      >\n        <div\n          className=\"relative w-full h-full flex items-center justify-center\"\n          onClick={(e) => e.stopPropagation()}\n          {...handlers}\n        >\n          <motion.img\n            src={photo.secure_url}\n            alt={photo.context?.custom?.caption || ''}\n            style={{ scale }}\n            className=\"max-h-screen max-w-full object-contain\"\n          />\n          \n          <div className=\"absolute bottom-4 left-0 right-0 flex justify-center space-x-4\">\n            <button\n              onClick={handleZoomIn}\n              className=\"bg-white bg-opacity-20 p-2 rounded-full\"\n            >\n              Zoom +\n            </button>\n            <button\n              onClick={handleZoomOut}\n              className=\"bg-white bg-opacity-20 p-2 rounded-full\"\n            >\n              Zoom -\n            </button>\n            <button\n              onClick={handleReset}\n              className=\"bg-white bg-opacity-20 p-2 rounded-full\"\n            >\n              Reset\n            </button>\n          </div>\n          \n          <button\n            className=\"absolute top-4 right-4 text-white text-2xl\"\n            onClick={onClose}\n          >\n            &times;\n          </button>\n          \n          <button\n            className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-white text-4xl\"\n            onClick={() => currentIndex > 0 && onNavigate(currentIndex - 1)}\n            disabled={currentIndex === 0}\n          >\n            &lt;\n          </button>\n          \n          <button\n            className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-white text-4xl\"\n            onClick={() => currentIndex < photos.length - 1 && onNavigate(currentIndex + 1)}\n            disabled={currentIndex === photos.length - 1}\n          >\n            &gt;\n          </button>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  );\n};\n\nexport default PhotoModal;\n```\n3. Update PhotoGallery component to integrate with modal:\n```typescript\n// Add to PhotoGallery.tsx\nconst [modalOpen, setModalOpen] = useState(false);\nconst [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n\nconst handlePhotoClick = (index) => {\n  setCurrentPhotoIndex(index);\n  setModalOpen(true);\n};\n\nconst handleCloseModal = () => {\n  setModalOpen(false);\n};\n\nconst handleNavigate = (newIndex) => {\n  setCurrentPhotoIndex(newIndex);\n};\n\n// Add to return statement\n<PhotoModal\n  photos={photos}\n  currentIndex={currentPhotoIndex}\n  isOpen={modalOpen}\n  onClose={handleCloseModal}\n  onNavigate={handleNavigate}\n/>\n```\n4. Implement pinch-to-zoom functionality using gesture handlers\n5. Add smooth transitions between photos\n6. Ensure scroll position is maintained when closing the modal",
      "testStrategy": "1. Test modal opening and closing\n2. Verify swipe gestures work for navigation\n3. Test pinch-to-zoom functionality on mobile devices\n4. Confirm scroll position is maintained when closing the modal\n5. Test keyboard navigation (arrow keys)\n6. Verify accessibility features work correctly",
      "priority": "medium",
      "dependencies": [
        4
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 6,
      "title": "Cloudinary Upload Widget Integration",
      "description": "Integrate Cloudinary Upload Widget for mobile-optimized photo uploads with support for multiple sources.",
      "details": "1. Create UploadWidget component in components/UploadWidget.tsx:\n```typescript\nimport React, { useEffect, useRef } from 'react';\n\ninterface UploadWidgetProps {\n  onSuccess?: (result: any) => void;\n  onFailure?: (error: any) => void;\n}\n\ndeclare global {\n  interface Window {\n    cloudinary: any;\n  }\n}\n\nconst UploadWidget: React.FC<UploadWidgetProps> = ({ onSuccess, onFailure }) => {\n  const cloudinaryRef = useRef<any>();\n  const widgetRef = useRef<any>();\n  \n  useEffect(() => {\n    // Add Cloudinary script if not already loaded\n    if (!cloudinaryRef.current) {\n      const script = document.createElement('script');\n      script.src = 'https://upload-widget.cloudinary.com/global/all.js';\n      script.async = true;\n      document.body.appendChild(script);\n      \n      script.onload = () => {\n        cloudinaryRef.current = window.cloudinary;\n        initializeWidget();\n      };\n    } else {\n      initializeWidget();\n    }\n    \n    return () => {\n      // Clean up widget if component unmounts\n      if (widgetRef.current) {\n        widgetRef.current.destroy();\n      }\n    };\n  }, []);\n  \n  const initializeWidget = () => {\n    if (!cloudinaryRef.current) return;\n    \n    widgetRef.current = cloudinaryRef.current.createUploadWidget(\n      {\n        cloudName: process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,\n        uploadPreset: process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,\n        sources: [\n          'local',\n          'camera',\n          'url',\n          'google_drive',\n          'dropbox',\n          'instagram',\n          'shutterstock',\n          'getty',\n          'unsplash'\n        ],\n        multiple: true,\n        maxFiles: 50,\n        styles: {\n          palette: {\n            window: '#FFFFFF',\n            windowBorder: '#90A0B3',\n            tabIcon: '#0078FF',\n            menuIcons: '#5A616A',\n            textDark: '#000000',\n            textLight: '#FFFFFF',\n            link: '#0078FF',\n            action: '#FF620C',\n            inactiveTabIcon: '#0E2F5A',\n            error: '#F44235',\n            inProgress: '#0078FF',\n            complete: '#20B832',\n            sourceBg: '#E4EBF1'\n          },\n          fonts: {\n            default: null,\n            \"'Poppins', sans-serif\": {\n              url: 'https://fonts.googleapis.com/css?family=Poppins',\n              active: true\n            }\n          }\n        },\n        showUploadMoreButton: true,\n        autoMinimize: true,\n        showAdvancedOptions: false,\n        showPoweredBy: false,\n      },\n      (error: any, result: any) => {\n        if (!error && result && result.event === 'success') {\n          if (onSuccess) onSuccess(result.info);\n        }\n        \n        if (error) {\n          if (onFailure) onFailure(error);\n        }\n      }\n    );\n  };\n  \n  const openWidget = () => {\n    if (widgetRef.current) {\n      widgetRef.current.open();\n    }\n  };\n  \n  return (\n    <button\n      onClick={openWidget}\n      className=\"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg fixed bottom-6 right-6 z-10\"\n    >\n      Upload Photos\n    </button>\n  );\n};\n\nexport default UploadWidget;\n```\n2. Create upload preset in Cloudinary dashboard with the following settings:\n   - Enable unsigned uploads\n   - Configure auto-tagging\n   - Set up format conversion (HEIC to JPEG)\n   - Enable auto-orientation fix\n   - Configure metadata preservation\n3. Add environment variables for upload widget:\n```\nNEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your_cloud_name\nNEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET=your_upload_preset\n```\n4. Add UploadWidget to main layout for authenticated users with upload permission\n5. Implement upload success and failure handlers\n6. Add progress tracking and notifications",
      "testStrategy": "1. Test upload functionality with different file types (JPEG, PNG, HEIC)\n2. Verify mobile uploads work correctly\n3. Test uploads from different sources (camera, gallery, cloud services)\n4. Confirm error handling works for failed uploads\n5. Test multiple file uploads\n6. Verify automatic processing (format conversion, orientation fix)",
      "priority": "high",
      "dependencies": [
        2,
        3
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 7,
      "title": "Image Optimization Implementation",
      "description": "Implement image optimization techniques including responsive images, WebP/AVIF delivery, and lazy loading.",
      "details": "1. Create optimized image component in components/OptimizedImage.tsx:\n```typescript\nimport React from 'react';\nimport Image from 'next/image';\nimport { CldImage } from 'next-cloudinary';\n\ninterface OptimizedImageProps {\n  publicId: string;\n  alt: string;\n  width: number;\n  height: number;\n  priority?: boolean;\n  sizes?: string;\n}\n\nconst OptimizedImage: React.FC<OptimizedImageProps> = ({\n  publicId,\n  alt,\n  width,\n  height,\n  priority = false,\n  sizes = '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw',\n}) => {\n  return (\n    <CldImage\n      src={publicId}\n      width={width}\n      height={height}\n      alt={alt || 'Photo'}\n      priority={priority}\n      sizes={sizes}\n      format=\"auto\"\n      quality=\"auto\"\n      loading={priority ? 'eager' : 'lazy'}\n      placeholder=\"blur\"\n      blurDataURL=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+P+/HgAEtAI8QfmZPgAAAABJRU5ErkJggg==\"\n    />\n  );\n};\n\nexport default OptimizedImage;\n```\n2. Update PhotoGallery to use OptimizedImage component\n3. Configure Cloudinary transformations for optimal delivery:\n```typescript\n// Example transformation URL parameters\nconst transformationOptions = {\n  quality: 'auto',\n  fetchFormat: 'auto', // For WebP/AVIF delivery\n  responsive: true,\n  width: 'auto',\n  dpr: 'auto',\n};\n```\n4. Implement responsive image sizes based on viewport\n5. Set up lazy loading with placeholders\n6. Configure progressive enhancement for image loading",
      "testStrategy": "1. Test image loading performance using Lighthouse\n2. Verify WebP/AVIF format delivery on supported browsers\n3. Test lazy loading behavior\n4. Measure image load times on different network conditions\n5. Verify placeholder images appear correctly\n6. Test responsive behavior across different screen sizes",
      "priority": "high",
      "dependencies": [
        2,
        4
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 8,
      "title": "Caching and Service Worker Implementation",
      "description": "Implement service worker for offline capabilities, smart prefetching, and caching strategies.",
      "details": "1. Install Workbox for service worker management:\n```bash\nnpm install workbox-window workbox-webpack-plugin\n```\n2. Create service worker configuration in next.config.js:\n```javascript\nconst withPWA = require('next-pwa');\n\nmodule.exports = withPWA({\n  pwa: {\n    dest: 'public',\n    register: true,\n    skipWaiting: true,\n    disable: process.env.NODE_ENV === 'development',\n  },\n});\n```\n3. Create custom service worker in public/sw.js:\n```javascript\nimportScripts('https://storage.googleapis.com/workbox-cdn/releases/6.1.5/workbox-sw.js');\n\nworkbox.setConfig({\n  debug: false,\n});\n\nworkbox.routing.registerRoute(\n  /\\/api\\/photos/,\n  new workbox.strategies.StaleWhileRevalidate({\n    cacheName: 'photo-api-cache',\n    plugins: [\n      new workbox.expiration.ExpirationPlugin({\n        maxEntries: 50,\n        maxAgeSeconds: 60 * 60 * 24, // 1 day\n      }),\n    ],\n  })\n);\n\nworkbox.routing.registerRoute(\n  /\\.(?:png|jpg|jpeg|svg|gif|webp)$/,\n  new workbox.strategies.CacheFirst({\n    cacheName: 'images-cache',\n    plugins: [\n      new workbox.expiration.ExpirationPlugin({\n        maxEntries: 100,\n        maxAgeSeconds: 60 * 60 * 24 * 30, // 30 days\n      }),\n    ],\n  })\n);\n\nworkbox.routing.registerRoute(\n  /^https:\\/\\/res\\.cloudinary\\.com/,\n  new workbox.strategies.CacheFirst({\n    cacheName: 'cloudinary-images',\n    plugins: [\n      new workbox.expiration.ExpirationPlugin({\n        maxEntries: 200,\n        maxAgeSeconds: 60 * 60 * 24 * 30, // 30 days\n      }),\n    ],\n  })\n);\n\nworkbox.routing.registerRoute(\n  /\\.(?:js|css)$/,\n  new workbox.strategies.StaleWhileRevalidate({\n    cacheName: 'static-resources',\n  })\n);\n\nworkbox.routing.registerRoute(\n  /^https:\\/\\/fonts\\.googleapis\\.com/,\n  new workbox.strategies.StaleWhileRevalidate({\n    cacheName: 'google-fonts',\n  })\n);\n\nself.addEventListener('install', (event) => {\n  self.skipWaiting();\n});\n```\n4. Implement smart prefetching for images\n5. Add offline fallback page\n6. Configure CDN integration with Cloudinary",
      "testStrategy": "1. Test offline functionality by disabling network\n2. Verify cached images load when offline\n3. Measure performance improvements with caching\n4. Test service worker update process\n5. Verify prefetching behavior\n6. Test offline fallback page",
      "priority": "medium",
      "dependencies": [
        4,
        7
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 9,
      "title": "Performance Optimization",
      "description": "Implement performance optimizations to achieve 90+ Lighthouse scores across all metrics.",
      "details": "1. Implement code splitting and dynamic imports:\n```typescript\nimport dynamic from 'next/dynamic';\n\nconst PhotoModal = dynamic(() => import('@/components/PhotoModal'), {\n  loading: () => <div>Loading...</div>,\n});\n```\n2. Optimize JavaScript bundle size:\n   - Use tree-shaking\n   - Implement bundle analyzer:\n   ```bash\n   npm install --save-dev @next/bundle-analyzer\n   ```\n   - Configure in next.config.js\n3. Implement font optimization:\n   - Use next/font for optimized font loading\n   - Implement font-display: swap\n4. Add performance monitoring:\n```typescript\n// In _app.tsx\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/router';\n\nexport function reportWebVitals({ id, name, label, value }) {\n  // Analytics implementation\n  console.log(name, value);\n}\n\nfunction MyApp({ Component, pageProps }) {\n  const router = useRouter();\n  \n  useEffect(() => {\n    const handleRouteChange = (url) => {\n      // Track page views\n    };\n    \n    router.events.on('routeChangeComplete', handleRouteChange);\n    return () => {\n      router.events.off('routeChangeComplete', handleRouteChange);\n    };\n  }, [router.events]);\n  \n  return <Component {...pageProps} />;\n}\n```\n5. Implement virtualization for large lists:\n```bash\nnpm install react-virtualized\n```\n6. Optimize Tailwind CSS:\n   - Configure purge options in tailwind.config.js\n   - Use JIT mode for smaller CSS bundles",
      "testStrategy": "1. Run Lighthouse audits to measure performance scores\n2. Test Time to First Contentful Paint (target: < 1.5s)\n3. Test Time to Interactive (target: < 3.5s)\n4. Measure JavaScript bundle size (target: < 200KB gzipped)\n5. Measure CSS size (target: < 50KB)\n6. Test performance on low-end devices and slow connections",
      "priority": "medium",
      "dependencies": [
        4,
        7,
        8
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 10,
      "title": "Accessibility Implementation",
      "description": "Implement accessibility features to achieve WCAG 2.1 AA compliance and 100/100 accessibility score.",
      "details": "1. Install axe-core for accessibility testing:\n```bash\nnpm install --save-dev @axe-core/react\n```\n2. Add accessibility testing to development environment:\n```typescript\n// In _app.tsx (development only)\nimport React from 'react';\nimport { useEffect } from 'react';\n\nfunction MyApp({ Component, pageProps }) {\n  useEffect(() => {\n    if (process.env.NODE_ENV !== 'production') {\n      import('@axe-core/react').then(axe => {\n        axe.default(React, 1000);\n      });\n    }\n  }, []);\n  \n  return <Component {...pageProps} />;\n}\n```\n3. Implement keyboard navigation support:\n```typescript\n// Example for PhotoModal.tsx\nconst handleKeyDown = (e: React.KeyboardEvent) => {\n  if (e.key === 'Escape') {\n    onClose();\n  } else if (e.key === 'ArrowRight') {\n    if (currentIndex < photos.length - 1) {\n      onNavigate(currentIndex + 1);\n    }\n  } else if (e.key === 'ArrowLeft') {\n    if (currentIndex > 0) {\n      onNavigate(currentIndex - 1);\n    }\n  }\n};\n\n// Add to component\n<div onKeyDown={handleKeyDown} tabIndex={0}>\n```\n4. Add proper ARIA attributes to components\n5. Ensure sufficient color contrast\n6. Add focus indicators for keyboard navigation\n7. Implement screen reader compatibility",
      "testStrategy": "1. Run axe-core tests to identify accessibility issues\n2. Test keyboard navigation throughout the application\n3. Verify screen reader compatibility using NVDA or VoiceOver\n4. Check color contrast ratios\n5. Test focus indicators for keyboard navigation\n6. Verify ARIA attributes are correctly implemented",
      "priority": "medium",
      "dependencies": [
        4,
        5,
        6
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 11,
      "title": "Main Layout and Navigation Implementation",
      "description": "Create the main application layout with responsive design and navigation elements.",
      "details": "1. Create layout component in app/layout.tsx:\n```typescript\nimport React from 'react';\nimport { Inter } from 'next/font/google';\nimport './globals.css';\n\nconst inter = Inter({ subsets: ['latin'] });\n\nexport const metadata = {\n  title: 'Team Todd Photo Gallery',\n  description: 'A private family photo gallery',\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\">\n      <body className={inter.className}>\n        <header className=\"bg-white shadow-sm py-4\">\n          <div className=\"container mx-auto px-4 flex justify-between items-center\">\n            <h1 className=\"text-xl font-bold\">Team Todd Photo Gallery</h1>\n            <nav>\n              <ul className=\"flex space-x-4\">\n                <li>\n                  <a href=\"/\" className=\"text-blue-500 hover:text-blue-700\">\n                    Gallery\n                  </a>\n                </li>\n                <li>\n                  <a href=\"/upload\" className=\"text-blue-500 hover:text-blue-700\">\n                    Upload\n                  </a>\n                </li>\n              </ul>\n            </nav>\n          </div>\n        </header>\n        <main className=\"container mx-auto px-4 py-8\">{children}</main>\n        <footer className=\"bg-gray-100 py-4 mt-8\">\n          <div className=\"container mx-auto px-4 text-center text-gray-500\">\n            &copy; {new Date().getFullYear()} Team Todd Photo Gallery\n          </div>\n        </footer>\n      </body>\n    </html>\n  );\n}\n```\n2. Create home page in app/page.tsx:\n```typescript\nimport React from 'react';\nimport PhotoGallery from '@/components/PhotoGallery';\nimport UploadWidget from '@/components/UploadWidget';\n\nexport default function Home() {\n  return (\n    <div>\n      <PhotoGallery />\n      <UploadWidget\n        onSuccess={(result) => {\n          console.log('Upload success:', result);\n          // Refresh gallery\n        }}\n        onFailure={(error) => {\n          console.error('Upload error:', error);\n        }}\n      />\n    </div>\n  );\n}\n```\n3. Implement responsive design with Tailwind CSS\n4. Add mobile navigation menu\n5. Implement conditional rendering based on authentication status",
      "testStrategy": "1. Test responsive layout on different screen sizes\n2. Verify navigation works correctly\n3. Test conditional rendering based on authentication\n4. Verify mobile navigation menu works correctly\n5. Test layout with different content lengths",
      "priority": "medium",
      "dependencies": [
        1,
        3
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 12,
      "title": "API Routes Implementation",
      "description": "Implement API routes for photo retrieval, authentication, and upload management.",
      "details": "1. Create authentication API in app/api/auth/route.ts:\n```typescript\nimport { NextRequest, NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\nimport { encrypt } from '@/lib/encryption';\n\nexport async function POST(request: NextRequest) {\n  const data = await request.json();\n  const { password, type } = data;\n  \n  const uploadPassword = process.env.UPLOAD_PASSWORD;\n  const galleryPassword = process.env.GALLERY_PASSWORD;\n  \n  let isAuthorized = false;\n  let role = '';\n  \n  if (password === uploadPassword) {\n    isAuthorized = true;\n    role = 'uploader';\n  } else if (password === galleryPassword) {\n    isAuthorized = true;\n    role = 'viewer';\n  }\n  \n  if (!isAuthorized) {\n    return NextResponse.json(\n      { error: 'Invalid password' },\n      { status: 401 }\n    );\n  }\n  \n  // Set session duration (in hours)\n  const sessionDuration = parseInt(process.env.SESSION_DURATION || '168');\n  const expiresIn = 60 * 60 * sessionDuration;\n  \n  // Create encrypted token\n  const token = encrypt(JSON.stringify({\n    role,\n    exp: Math.floor(Date.now() / 1000) + expiresIn,\n  }));\n  \n  // Set cookie\n  cookies().set({\n    name: 'auth-token',\n    value: token,\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    maxAge: expiresIn,\n    path: '/',\n  });\n  \n  return NextResponse.json({ success: true, role });\n}\n```\n2. Create photos API in app/api/photos/route.ts (expanded from task 4):\n```typescript\nimport { NextRequest, NextResponse } from 'next/server';\nimport cloudinary from '@/lib/cloudinary';\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const page = parseInt(searchParams.get('page') || '1');\n  const limit = parseInt(searchParams.get('limit') || '30');\n  const nextCursor = searchParams.get('next_cursor');\n  const folder = searchParams.get('folder') || '';\n  \n  try {\n    let expression = 'resource_type:image';\n    if (folder) {\n      expression += ` AND folder=${folder}`;\n    }\n    \n    const result = await cloudinary.v2.search\n      .expression(expression)\n      .sort_by('created_at', 'desc')\n      .max_results(limit)\n      .next_cursor(nextCursor)\n      .execute();\n      \n    return NextResponse.json({\n      photos: result.resources,\n      next_cursor: result.next_cursor,\n      total_count: result.total_count,\n    });\n  } catch (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n```\n3. Create encryption utility in lib/encryption.ts:\n```typescript\nimport crypto from 'crypto';\n\nconst ENCRYPTION_KEY = process.env.ENCRYPTION_KEY || 'default-key-that-is-32-chars-long!';\nconst IV_LENGTH = 16;\n\nexport function encrypt(text: string): string {\n  const iv = crypto.randomBytes(IV_LENGTH);\n  const cipher = crypto.createCipheriv(\n    'aes-256-cbc',\n    Buffer.from(ENCRYPTION_KEY),\n    iv\n  );\n  let encrypted = cipher.update(text, 'utf8', 'hex');\n  encrypted += cipher.final('hex');\n  return `${iv.toString('hex')}:${encrypted}`;\n}\n\nexport function decrypt(text: string): string {\n  const [ivHex, encryptedHex] = text.split(':');\n  const iv = Buffer.from(ivHex, 'hex');\n  const decipher = crypto.createDecipheriv(\n    'aes-256-cbc',\n    Buffer.from(ENCRYPTION_KEY),\n    iv\n  );\n  let decrypted = decipher.update(encryptedHex, 'hex', 'utf8');\n  decrypted += decipher.final('utf8');\n  return decrypted;\n}\n```\n4. Add API route for logout in app/api/auth/logout/route.ts\n5. Implement rate limiting for API routes\n6. Add CORS configuration for Cloudinary",
      "testStrategy": "1. Test authentication API with valid and invalid passwords\n2. Verify photo retrieval API returns correct data\n3. Test pagination and filtering in photo API\n4. Verify encryption and decryption functions work correctly\n5. Test rate limiting functionality\n6. Verify CORS configuration works correctly",
      "priority": "high",
      "dependencies": [
        2,
        3
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 13,
      "title": "Error Handling and Logging",
      "description": "Implement comprehensive error handling, logging, and monitoring throughout the application.",
      "details": "1. Create error boundary component in components/ErrorBoundary.tsx:\n```typescript\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error?: Error;\n}\n\nclass ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    // Log error to monitoring service\n    console.error('Error caught by boundary:', error, errorInfo);\n  }\n\n  render(): ReactNode {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n      \n      return (\n        <div className=\"p-4 bg-red-50 border border-red-200 rounded-md\">\n          <h2 className=\"text-lg font-semibold text-red-800\">Something went wrong</h2>\n          <p className=\"mt-2 text-red-700\">\n            {this.state.error?.message || 'An unexpected error occurred'}\n          </p>\n          <button\n            className=\"mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700\"\n            onClick={() => window.location.reload()}\n          >\n            Reload page\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n```\n2. Create custom error page in app/error.tsx:\n```typescript\n'use client';\n\nimport React from 'react';\n\nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error;\n  reset: () => void;\n}) {\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-[50vh] p-4\">\n      <h2 className=\"text-2xl font-bold text-red-600 mb-4\">Something went wrong!</h2>\n      <p className=\"text-gray-600 mb-6\">{error.message || 'An unexpected error occurred'}</p>\n      <button\n        onClick={reset}\n        className=\"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n      >\n        Try again\n      </button>\n    </div>\n  );\n}\n```\n3. Create not-found page in app/not-found.tsx\n4. Implement global error handler:\n```typescript\n// In lib/errorHandler.ts\nexport function logError(error: Error, context?: any) {\n  console.error('Application error:', error, context);\n  \n  // Send to monitoring service (future implementation)\n  // Example: sendToSentry(error, context);\n}\n\nexport function handleApiError(error: any) {\n  const errorMessage = error.response?.data?.message || error.message || 'An unexpected error occurred';\n  \n  logError(error);\n  \n  return {\n    error: errorMessage,\n    status: error.response?.status || 500,\n  };\n}\n```\n5. Add try/catch blocks to all API routes and data fetching functions\n6. Implement toast notifications for user feedback",
      "testStrategy": "1. Test error boundary by intentionally causing errors\n2. Verify custom error pages display correctly\n3. Test error handling in API routes\n4. Verify error logging works correctly\n5. Test not-found page\n6. Verify toast notifications appear for errors",
      "priority": "medium",
      "dependencies": [
        4,
        6,
        12
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 14,
      "title": "Progressive Web App (PWA) Implementation",
      "description": "Configure the application as a Progressive Web App with offline capabilities and installability.",
      "details": "1. Install next-pwa package:\n```bash\nnpm install next-pwa\n```\n2. Configure next.config.js for PWA:\n```javascript\nconst withPWA = require('next-pwa');\n\nmodule.exports = withPWA({\n  pwa: {\n    dest: 'public',\n    register: true,\n    skipWaiting: true,\n    disable: process.env.NODE_ENV === 'development',\n  },\n});\n```\n3. Create manifest.json in public/manifest.json:\n```json\n{\n  \"name\": \"Team Todd Photo Gallery\",\n  \"short_name\": \"Todd Gallery\",\n  \"description\": \"A private family photo gallery\",\n  \"start_url\": \"/\",\n  \"display\": \"standalone\",\n  \"background_color\": \"#ffffff\",\n  \"theme_color\": \"#0078FF\",\n  \"icons\": [\n    {\n      \"src\": \"/icons/icon-192x192.png\",\n      \"sizes\": \"192x192\",\n      \"type\": \"image/png\",\n      \"purpose\": \"any maskable\"\n    },\n    {\n      \"src\": \"/icons/icon-512x512.png\",\n      \"sizes\": \"512x512\",\n      \"type\": \"image/png\"\n    }\n  ]\n}\n```\n4. Create app icons in different sizes\n5. Add offline fallback page in public/offline.html\n6. Configure service worker to handle offline scenarios\n7. Add install prompt for PWA:\n```typescript\n// In components/InstallPrompt.tsx\nimport React, { useEffect, useState } from 'react';\n\nconst InstallPrompt: React.FC = () => {\n  const [installPrompt, setInstallPrompt] = useState<any>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n  \n  useEffect(() => {\n    const handleBeforeInstallPrompt = (e: any) => {\n      e.preventDefault();\n      setInstallPrompt(e);\n      setShowPrompt(true);\n    };\n    \n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    \n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    };\n  }, []);\n  \n  const handleInstallClick = () => {\n    if (!installPrompt) return;\n    \n    installPrompt.prompt();\n    installPrompt.userChoice.then((choiceResult: any) => {\n      if (choiceResult.outcome === 'accepted') {\n        console.log('User accepted the install prompt');\n      }\n      setInstallPrompt(null);\n      setShowPrompt(false);\n    });\n  };\n  \n  if (!showPrompt) return null;\n  \n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-blue-50 p-4 shadow-lg\">\n      <div className=\"flex justify-between items-center\">\n        <p className=\"text-blue-800\">Install this app on your device for quick access</p>\n        <div className=\"flex space-x-2\">\n          <button\n            onClick={() => setShowPrompt(false)}\n            className=\"px-3 py-1 text-blue-600 border border-blue-600 rounded-md\"\n          >\n            Not now\n          </button>\n          <button\n            onClick={handleInstallClick}\n            className=\"px-3 py-1 bg-blue-600 text-white rounded-md\"\n          >\n            Install\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default InstallPrompt;\n```",
      "testStrategy": "1. Test PWA installability on different devices\n2. Verify offline functionality works correctly\n3. Test service worker update process\n4. Verify app icons display correctly\n5. Test install prompt behavior\n6. Verify manifest.json is correctly configured",
      "priority": "low",
      "dependencies": [
        8
      ],
      "status": "pending",
      "subtasks": []
    },
    {
      "id": 15,
      "title": "Testing and Deployment",
      "description": "Implement comprehensive testing strategy and configure deployment pipeline.",
      "details": "1. Set up Jest and React Testing Library:\n```typescript\n// In jest.config.js\nmodule.exports = {\n  testEnvironment: 'jsdom',\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],\n  testPathIgnorePatterns: ['<rootDir>/.next/', '<rootDir>/node_modules/'],\n  moduleNameMapper: {\n    '^@/components/(.*)$': '<rootDir>/components/$1',\n    '^@/lib/(.*)$': '<rootDir>/lib/$1',\n  },\n};\n\n// In jest.setup.js\nimport '@testing-library/jest-dom';\n```\n2. Create component tests:\n```typescript\n// Example test for PhotoGallery.test.tsx\nimport { render, screen } from '@testing-library/react';\nimport PhotoGallery from '@/components/PhotoGallery';\n\n// Mock SWR\njest.mock('swr', () => ({\n  __esModule: true,\n  default: () => ({\n    data: {\n      photos: [\n        {\n          public_id: 'test-1',\n          secure_url: 'https://example.com/test-1.jpg',\n          width: 800,\n          height: 600,\n        },\n      ],\n    },\n    error: null,\n    isLoading: false,\n  }),\n}));\n\ndescribe('PhotoGallery', () => {\n  it('renders the gallery', () => {\n    render(<PhotoGallery />);\n    expect(screen.getByRole('img')).toBeInTheDocument();\n  });\n});\n```\n3. Set up Cypress for integration testing:\n```bash\nnpm install --save-dev cypress\n```\n4. Create Cypress tests:\n```javascript\n// In cypress/integration/gallery.spec.js\ndescribe('Photo Gallery', () => {\n  beforeEach(() => {\n    cy.visit('/');\n  });\n  \n  it('displays the gallery', () => {\n    cy.get('[data-testid=\"photo-gallery\"]').should('be.visible');\n  });\n  \n  it('opens photo modal when clicking a photo', () => {\n    cy.get('[data-testid=\"photo-item\"]').first().click();\n    cy.get('[data-testid=\"photo-modal\"]').should('be.visible');\n  });\n});\n```\n5. Set up Lighthouse CI:\n```bash\nnpm install --save-dev @lhci/cli\n```\n6. Configure GitHub Actions for CI/CD in .github/workflows/ci.yml:\n```yaml\nname: CI/CD\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n        with:\n          node-version: '18'\n      - name: Install dependencies\n        run: npm ci\n      - name: Run linting\n        run: npm run lint\n      - name: Run tests\n        run: npm test\n      - name: Run Cypress tests\n        uses: cypress-io/github-action@v2\n        with:\n          build: npm run build\n          start: npm start\n      - name: Run Lighthouse CI\n        run: npx lhci autorun\n\n  deploy:\n    needs: test\n    if: github.ref == 'refs/heads/main'\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: amondnet/vercel-action@v20\n        with:\n          vercel-token: ${{ secrets.VERCEL_TOKEN }}\n          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}\n          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}\n          vercel-args: '--prod'\n```\n7. Configure Vercel for deployment\n8. Set up environment variables in Vercel dashboard",
      "testStrategy": "1. Run unit tests with Jest\n2. Run integration tests with Cypress\n3. Run Lighthouse CI to measure performance\n4. Test deployment process to Vercel\n5. Verify environment variables are correctly set in production\n6. Test the application in production environment",
      "priority": "high",
      "dependencies": [
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14
      ],
      "status": "pending",
      "subtasks": []
    }
  ]
}